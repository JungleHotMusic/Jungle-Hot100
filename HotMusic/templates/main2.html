<!Doctype html>
<html lang="ko">

<head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bulma-->
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bulma@0.9.1/css/bulma.min.css">

    <!-- JS -->
    <script src="https://code.jquery.com/jquery-3.5.1.slim.min.js"
        integrity="sha384-DfXdz2htPH0lsSSs5nCTpuj/zy4C+OGpamoFVy38MVBnE+IbbVYUew+OrCXaRkfj"
        crossorigin="anonymous"></script>
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>

    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.16.1/dist/umd/popper.min.js"
        integrity="sha384-9/reFTGAW83EW2RDu2S0VKaIzap3H66lZH81PoYlFhbGU+6BZp6G7niu735Sk7lN"
        crossorigin="anonymous"></script>

    <!-- 구글폰트 -->
    <link href="https://fonts.googleapis.com/css?family=Do+Hyeon&amp;display=swap" rel="stylesheet">
    <title>SW사관학교 정글 4기 A-5 | HOT 100</title>

    <!-- style -->
    <style type="text/css">
        .wrap {
            width: 800px;
            margin: auto;
        }

        .banner-container {
            margin: auto;
            height: 300px;
            background-image: url('../static/main.jpg');
            background-position: center;
            background-size: cover;
        }

        .mylist-container {
            margin-top: 10px;
            margin: 20px auto;
            padding: 20px;
            border: lightgray solid;
        }

        .ranking-container {
            margin-top: 10px;
            margin-bottom: 100px;
        }
    </style>
    <script>
        $(document).ready(function () {
            // 기본 화면 설정
            $("#defaultDiv").show();
            $("#editDiv").hide();
            $("#buttonEdit").show();
            $("#buttonDelete").hide();

            
        });
        
        
            $(".button.is-success.is-small.addbutton").on('click', function(){            

                    var tr = $(this).closest('tr');
                    var title = tr.children('td:eq(2)').text();
                    var artist = tr.children('td:eq(3)').text();
                    

                    console.log(tr)

                

                $.ajax({
                    type : "POST",
                    url : "/playlist",
                    data:{title_give: title, artist_give: artist},
                    success: function (response) {
                        if (response["result"] == "success") {
                            alert(response["msg"]);
                            window.location.reload()

                        }else {
                            alert("서버 오류!")
                        }
                    }
                });
            })
                
            
               
            


            // 수정 중
            function editPlaylist() {
                // 플레이리스트 수정시 화면 설정
                // $("#defaultDiv").hide();
                // $("#editDiv").show();
                // $("#buttonEdit").hide();
                // $("#buttonDelete").show();

                // id 값 post-box의 display 값이 block 이면(= 눈에 보이면)
                if ($("#editDiv").css("display") == "block") {
                    // post-box를 가리고
                    $("#post-box").hide();
                    // [선택 삭제] 버튼을 표시
                    $("#buttonDelete").show();
                    // 다시 버튼을 클릭하면, 박스 열기를 할 수 있게 텍스트 바꿔두기
                    $("#buttonEdit").text("플레이리스트 수정");
                } else {
                    // 아니면(눈에 보이지 않으면) post-box를 펴라
                    $("#editDiv").show();
                    // 다시 버튼을 클릭하면, 박스 닫기를 할 수 있게 텍스트 바꿔두기
                    $("#buttonEdit").text("수정 취소");
                }
            }

    </script>
</head>

<body>
    <div class="wrap">
        <section class="hero banner-container">
            <div class="hero-head">
                <nav class="breadcrumb is-right" aria-label="breadcrumbs">
                    <ul>
                        {% if is_login == "True" %}
                        <li><a href="#">로그아웃</a></li>
                        {% else %}
                        <li><a href="#">로그인/회원가입</a></li>
                        {% endif %}
                    </ul>
                </nav>
            </div>
        </section>

        {% if is_login == "True" %}
        <section class="mylist-container">
            <p class="title">나만의 플레이리스트</p>
            <div id="defaultDiv" class="mylist-container">
                <ul>
                    {% for item in myList %}
                    <li>
                        <a href="{{item['clickurl']}}">{{item['title']}}</a> - {{item['artist']}}
                    </li>
                    {% endfor %}
                </ul>
            </div>
            <div id="editDiv" class="mylist-container">
                <ul>
                    {% for item in myList %}
                    <li><label class="checkbox">
                            <input type="checkbox">
                            {{item['title']}} - {{item['artist']}}
                        </label></li>
                    {% endfor %}
                </ul>
            </div>
            <div class="buttons is-centered">
                <button id="buttonEdit" class="button is-success" onclick="editPlaylist()">플레이리스트 수정</button>
                <button id="buttonDelete" class="button is-danger" onclick="editPlaylist()">선택 삭제</button>
            </div>
        </section>
        {% endif %}

        <section class="ranking-container">
            <p class="title">ranking</p>
            <table class="table is-hoverable is-fullwidth">
                <thead>
                    <tr>
                        <th>앨범</th>
                        <th><abbr title="rank">순위</abbr></th>
                        <th>곡제목</th>
                        <th>아티스트</th>
                        <th>플레이리스트 담기</th>
                    </tr>
                </thead>
                <tbody>
                    {% for dict_item in musics %}
                    <tr>
                        <td>
                            <figure class="image image is-48x48">
                                <img src="{{dict_item['img_url']}}">
                            </figure>
                        </td>
                        <td>{{dict_item['rank']}}</td>
                        <td><a href="{{dict_item['click_url']}}">{{dict_item['music']}}</a></td>
                        <td>{{dict_item['artist']}}</th>
                        <td>
                            {% if is_login == "True" %}
                            <button class="button is-success is-small addbutton">+</button>
                            {% else %}
                            <button class="button is-success is-small" title="Disabled button" disabled>+</button>
                            {% endif %}
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </section>
    </div>
</body>

</html>